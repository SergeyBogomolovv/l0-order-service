# Демонстрационный сервис с Kafka, PostgreSQL, кешем

## Что реализовано

- Чтение данных о заказах из Kafka и сохранение их в базу данных. В базе данных было создано несколько таблиц для хранения данных о заказе, сохранение происходит с использованием транзакции и retry с exponential backoff. Так же все невалидные и несохраненные сообщения отправляются в DLQ.

- Получение данных о заказе по id, так же реализовано кэширование с самописным in memory LRU cache с использованием gob.

- Заполнение кэша актуальными данными о заказах при старте сервиса.

- Обработка сигналов - реализован graceful shutdown, закрываются коннекты к кафке, базе данных и выключается сервер.

- Подключение к postgres через пул с помощью стандартной библиотеки.

- Swagger документация API

- Валидация входных данных через validator

- Настроены базовые метрики для prometheus

## Используемые технологии и библиотеки

- Docker
- Kafka
- Kafka-UI для ручного тестирования
- PostgreSQL
- Prometheus
- Grafana
- sqlx + squirrel
- golang-migrate
- swaggo
- segmentio/kafka-go
- go validator
- mockery

## Инструкция для локального запуска

- Запустить нужные сервисы `docker compose up -d`
- Применить миграции `make migrate-up`
- Запустить приложение `make run`
- Установить зависимости для web `cd web && npm install`
- Запустить веб страницу `cd web && npm run dev`
- Запустить генератор рандомных заказов `cd order-generator && go run main.go`

## Описание архитектуры сервиса

Уровень handler - получают и валидируют данные из вне, тоесть из kafka и по http, парсят json и обрабатывают ошибки с входными данными.

Уровень service - выполняют основную логику сервиса.

Уровень repo - сохраняет и получает данные из бд.

Вспомогательная структура app инкапсулирует логику запуска компонентов приложения и другие вещи по типу настройки роутера.

В main файле происходит обьявление всех компонентов.

Entities это основные сущности с которыми работает приложение.

В pkg реализованы вспомогательные сущности - менеджер транзакций, LRU кэш и различные утилиты.
